<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.oti.thirtyone.dao.DocumentApprovalLineDAO">
	<insert id="insertDocumentApprovalLine" parameterType="DocApprovalLine">
		<![CDATA[
			INSERT INTO DOCUMENT_APPROVAL_LINE(
				doc_number, -- 문서번호
				doc_apr_approver, -- 결재자 명
				doc_apr_state, -- 결재 상태(승인, 반려, 보류, 대기 등)
				doc_apr_seq -- 결재 순번
			) VALUES (
				#{docNumber},
				#{docAprApprover},
				#{docAprState},
				#{docAprSeq}
			)
		]]>
	</insert>
	
	<select id="selectPenddingApprovalListById" parameterType="PageParam" resultType="DocApprovalLine">
		<![CDATA[
			SELECT
				doc_number, -- 문서번호
				doc_apr_approver, -- 결재자
				doc_apr_comment, -- 결재 의견
				doc_apr_state, -- 결재 상태(대기, 승인, 반려)
				doc_apr_type, -- 결재 유형
				doc_apr_date, -- 결재일자
				doc_apr_seq -- 결재 순번
			FROM DOCUMENT_APPROVAL_LINE
			WHERE 
				doc_apr_approver = #{docAprApprover}
			AND doc_apr_state = '대기'
		]]>
	</select>
	
	<select id="selectDraftApprovalLineByDocNumber" parameterType="String" resultType="DocApprovalLine">
		<![CDATA[
			SELECT
				doc_number,
				doc_apr_approver,
				doc_apr_comment,
				doc_apr_state,
				doc_apr_type,
				doc_apr_date,
				doc_apr_seq
			FROM DOCUMENT_APPROVAL_LINE
			WHERE doc_number = #{docNumber}
			ORDER BY doc_apr_seq
		]]>
	</select>
	
	<select id="selectReviewingApproverEmpId" parameterType="String" resultType="DocApprovalLine">
		<![CDATA[
			SELECT
				doc_apr_approver,
				doc_apr_state
			FROM DOCUMENT_APPROVAL_LINE
			WHERE doc_number = #{docNumber}
			AND doc_apr_state = '대기'
			ORDER BY doc_apr_seq
			FETCH FIRST 1 ROWS ONLY
		]]>
	</select>
	
	<update id="updateDocAprStatus" parameterType="Approval">
		<![CDATA[
			UPDATE DOCUMENT_APPROVAL_LINE
			SET DOC_APR_STATE = '취소'
			WHERE doc_number = #{docNumber}
		]]>
	</update>
</mapper>
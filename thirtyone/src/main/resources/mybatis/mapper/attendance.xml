<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.oti.thirtyone.dao.AttendanceDao">
	<select id="selectCheckInToday" parameterType="String"  resultType="int">
		select count(check_in)
		from attendances
		where TO_CHAR(atd_date, 'YY/MM/DD') = TO_CHAR(sysdate, 'YY/MM/DD') and emp_id = #{empId}
	</select>
	<insert id="insertCheckIn" parameterType="String">
		insert into attendances
			(atd_date, emp_id, check_in, atd_state, atd_standard_time)
		values
			(sysdate, #{empId}, sysdate, '정상출근', 8)
			
	</insert>
	<update id="updateCheckOut" parameterType="String">
		update attendances set check_out = sysdate
		where TO_CHAR(atd_date, 'YY/MM/DD') = TO_CHAR(sysdate, 'YY/MM/DD') and emp_id = #{empId}
	</update>
	
	<select id="selectAtdByEmpId" parameterType="String" resultType="Attendance">
		select atd_date, emp_id, check_in, check_out, atd_state, atd_standard_time, atd_over_time, atd_approved_time
		from attendances
		where TO_CHAR(atd_date, 'YY/MM/DD') = TO_CHAR(sysdate, 'YY/MM/DD') and emp_id = #{empId}
	</select>
	
	<select id="selectAtdForMonths" resultType="Attendance">
		select atd_date, emp_id, check_in, check_out, atd_state, atd_standard_time, atd_over_time, atd_approved_time
		from attendances
		WHERE atd_date BETWEEN
	        ADD_MONTHS(TO_DATE(#{month}, 'yyyy/MM/DD'), -1) AND
	        ADD_MONTHS(TO_DATE(#{month}, 'yyyy/MM/DD'), 1)
	    AND emp_id = #{empId}and emp_id=#{empId}
	</select>
	
	<select id="selectAtdMonthly" resultType="Attendance">
		select atd_date, emp_id, check_in, check_out, atd_state, atd_standard_time, atd_over_time, atd_approved_time
		from attendances
		where to_char(atd_date, 'yyyy/MM') = #{month} and emp_id=#{empId}
	</select>
</mapper>